<!doctype html>
<html lang="ms">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>HCTM Perolehan - Dashboard (Dark)</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { background: linear-gradient(180deg,#0f172a,#07103a); color: #e6eef8; }
    .card { background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.06); }
    .muted { color: #9fb0d6; }
    table th, table td { border-color: rgba(255,255,255,0.04); }
    .scrollbox { max-height:440px; overflow:auto; }
  </style>
</head>
<body class="p-6 font-sans">
  <div class="max-w-6xl mx-auto">
    <header class="mb-6">
      <h1 class="text-2xl font-semibold">Dashboard Perolehan - Unit Stor HCTM</h1>
      <p class="muted">Data merangkumi status kontrak aktif dan tamat.</p>
    </header>

    <section class="grid grid-cols-1 lg:grid-cols-6 gap-4">
      <div class="card p-4 rounded-lg"><h3 class="font-semibold mb-2">Jumlah Kontrak (RM)</h3><div id="cardTotalRM" class="text-2xl font-bold">-</div></div>
      <div class="card p-4 rounded-lg"><h3 class="font-semibold mb-2">Bilangan Perolehan</h3><div id="cardCount" class="text-2xl font-bold">-</div></div>
      <div class="card p-4 rounded-lg"><h3 class="font-semibold mb-2">Kontrak Aktif</h3><div id="cardActive" class="text-2xl font-bold">-</div></div>
      <div class="card p-4 rounded-lg"><h3 class="font-semibold mb-2">Kontrak Tamat</h3><div id="cardExpired" class="text-2xl font-bold">-</div></div>
      <div class="card p-4 rounded-lg col-span-2"><h3 class="font-semibold mb-2">Tender vs Sebut Harga</h3><canvas id="chartJenis" height="140"></canvas></div>
      <div class="card p-4 rounded-lg col-span-2"><h3 class="font-semibold mb-2">Trend Tahunan</h3><canvas id="chartTrend" height="140"></canvas></div>
    </section>

    <section class="mt-6 card p-4 rounded-lg">
      <h3 class="font-semibold mb-3">Senarai Perolehan</h3>
      <div class="scrollbox">
        <table class="min-w-full text-sm">
          <thead class="text-left sticky top-0 bg-transparent">
            <tr><th class="p-2">Tahun</th><th class="p-2">PIC</th><th class="p-2">Jenis</th><th class="p-2">Status</th><th class="p-2">Syarikat</th><th class="p-2">Nilai (RM)</th><th class="p-2">Tarikh Mula</th><th class="p-2">Tarikh Tamat</th></tr>
          </thead><tbody id="tableBody"></tbody>
        </table>
      </div>
    </section>
  </div>

<script>
async function loadData(){ const res = await fetch('data.json'); return res.json(); }
function formatRM(v){ return v?Number(v).toLocaleString():'-'; }
function countActive(rows){ const now=new Date(); return rows.filter(r=>r.tarikh_tamat && new Date(r.tarikh_tamat)>=now).length; }
function countExpired(rows){ const now=new Date(); return rows.filter(r=>r.tarikh_tamat && new Date(r.tarikh_tamat)<now).length; }
function renderTable(rows){ const tb=document.getElementById('tableBody'); tb.innerHTML=''; rows.forEach(r=>{ tb.innerHTML+=`<tr><td class='p-2'>${r.tahun||''}</td><td class='p-2'>${r.pic||''}</td><td class='p-2'>${r.jenis||''}</td><td class='p-2'>${r.status||''}</td><td class='p-2'>${r.syarikat||''}</td><td class='p-2'>${formatRM(r.nilai_kontrak_rm)}</td><td class='p-2'>${r.tarikh_mula?.slice(0,10)||''}</td><td class='p-2'>${r.tarikh_tamat?.slice(0,10)||''}</td></tr>` }); }
function aggregateSumRM(rows){ return rows.reduce((s,r)=>s+(r.nilai_kontrak_rm?Number(r.nilai_kontrak_rm):0),0); }
function aggregateBy(rows,key){ const map={}; rows.forEach(r=>{const k=r[key]||'LAIN'; map[k]=(map[k]||0)+1;}); return {labels:Object.keys(map),values:Object.values(map)}; }
function trendPerYear(rows){ const map={}; rows.forEach(r=>{const y=r.tahun||'LAIN'; map[y]=(map[y]||0)+1;}); const keys=Object.keys(map).filter(k=>k!=='LAIN').sort(); return {labels:keys,values:keys.map(k=>map[k])}; }
let CH={};
async function main(){ const rows=await loadData(); document.getElementById('cardCount').textContent=rows.length; document.getElementById('cardTotalRM').textContent=formatRM(aggregateSumRM(rows)); document.getElementById('cardActive').textContent=countActive(rows); document.getElementById('cardExpired').textContent=countExpired(rows); renderTable(rows); const byJenis=aggregateBy(rows,'jenis'); const trend=trendPerYear(rows); const ctxJ=document.getElementById('chartJenis').getContext('2d'); const ctxT=document.getElementById('chartTrend').getContext('2d'); CH.j=new Chart(ctxJ,{type:'bar',data:{labels:byJenis.labels,datasets:[{data:byJenis.values}]},options:{plugins:{legend:{display:false}}}}); CH.t=new Chart(ctxT,{type:'line',data:{labels:trend.labels,datasets:[{data:trend.values,fill:true,tension:0.3}]},options:{plugins:{legend:{display:false}}}}); }
main();
</script>
</body>
</html>